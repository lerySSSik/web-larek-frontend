# Проектная работа "Веб-ларек"
Интернет-магазин "Web-larek" для веб-разработчиков, где можно найти всё необходимое для успешной работы. Удобный каталог с подробными описаниями товаров, возможность добавления товаров в корзину и оформления заказов в пару кликов. Кроме того, вы можете детально ознакомиться с описанием каждого товара в карточке, чтобы выбрать именно то, что вам нужно.

## Оглавление
1. Обзор архитектуры
2. Технологический стек
3. Структура проекта
4. Важные файлы
5. Описание базовых классов
6. Описание классов Model 
7. View

## Обзор архитектуры
Проект реализован с использованием архитектурного паттерна MVP (Model-View-Presenter), который обеспечивает четкое разделение ответственности между ключевыми компонентами системы:

1. Модели (Model) — управление данными и бизнес-логикой:
   - ProductModel — отвечает за управление каталогом товаров;
   - BasketModel — отвечает за управление корзиной покупок;

2. Представления (View) — визуализация пользовательского интерфейса:
   - MainPageView — главная страница приложения с галереей товаров, где пользователи могут просматривать и выбирать интересующие их продукты;
   - ProductCard — универсальный компонент для отображения карточек товаров;
   - BasketView — отображает содержимое корзины покупок, включая список товаров, их количество и общую стоимость, а также предоставляет возможность оформления заказа;

3. Презентер (EventEmitter) — координация взаимодействия между слоями:
   - EventEmitter — связующее звено между моделью и представлением, которое обрабатывает события и передает данные между ними;

## Технологический стек
- HTML: Разметка веб-страниц с помощью тегов.
- SCSS: Препроцессор CSS с переменными, миксинами и функциями.
- TypeScript: Надстройка над JavaScript с статической типизацией.
- Webpack: Модуль-сборщик для объединения файлов, управления зависимостями и оптимизации кода.

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Описание базовых классов

## Класс `Api` (api.ts):
Предоставляет все необходимые методы для упрощения работы с API и гарантирует надежное выполнение запросов.

1. Основные свойства:
    - baseUrl (string): базовый URL для всех запросов, что позволяет легко менять хосты и сервисы;
    - options (RequestInit): настройки запроса, включая заголовки, параметры тела и другие параметры;

2. Функциональные методы:
    - get(uri: string): отправляет GET-запрос по указанному URL;
    - post(uri: string, data: object, method?: ApiPostMethods): универсальный метод для отправки POST/PUT/PATCH-запросов;

3. Интеллектуальный обработчик ответов:
    - Метод handleResponse(response: Response): обработчик ответа сервера;

## Класс `EventEmitter` (events.ts):
Реализует систему событий.

1. Основные свойства:
    - _events: Map<EventName, Set<Subscriber>>;
    - Хранит список подписчиков (callback) для каждого события (eventName);
    - Ключ: название события (string | RegExp);
    - Значение: Set функций-обработчиков;

2. Методы:
    1. on<T>(eventName, callback): 
        - подписывает callback на событие eventName;
        - если события нет — создает для него новый Set;

    2. off(eventName, callback):
        - Удаляет callback из списка подписчиков события eventName;
        - Если подписчиков не осталось — удаляет событие из _events;

    3. onAll(callback):
        - Подписывает callback на все события (специальное событие *);

    4. offAll():
        - Полностью очищает все подписки (сбрасывает _events).

3. Генерация событий: 
    1. emit<T>(eventName, data?):
        Вызывает все обработчики для:
            Конкретного события (eventName);
            Событий, совпадающих с RegExp;
            Глобальных подписчиков (*), если есть;
    2. trigger(eventName, context?):
        Возвращает функцию-триггер, которая при вызове генерирует событие eventName с данными context + event;

## Класс Component<T> 
Базовый абстрактный класс, наследуемый компонентами представления. Содержит методы для работы с DOM в дочерних компонентах. 

1. Конструктор : 
        constructor(
            protected readonly container: HTMLElement
        )

2. Методы:
    - toggleClass – переключить класс элемента;
    - setText – установить текстовое содержимое элемента;
    - setDisabled – изменить статус блокировки элемента;
    - setHidden, setVisible – скрыть и показать элемент соответственно;
    - setImage – установить изображение с альтернативным текстом;
    - render – предназначен для перерисовки компонентов представления при изменении данных;

## Описание классов Model.
Базовый класс для работы с данными и бизнес-логикой. Обеспечивает связь с представлением (View) через систему событий.

1. constructor(emitter: EventEmitter):
    - принимает Emitter для уведомлений представления об изменениях модели;

2. Свойства:
    - emitter: EventEmitter - Централизованный обработчик событий. Через него модель ведомляет View об изменениях данных и отправляет события;

## Описание класса Presenter.
Связующее звено между Model (данные) и View (интерфейс). Координирует их взаимодействие через события и колбэки. 
1. Конструктор: constructor(View: IViewConstructor<V, S>, model: M, emitter: E):
    - Принимает конструктор для view, модель данных и emitter.
2. Свойства :
    - view: IView<V>:Экземпляр View, управляющий отображением;
    - model: M : Экземпляр Model, хранящий данные и логику;
3. Методы :
    - bindView(): передает колбэки из Presenter во View;
    - bindModel(emitter: E): подписывает Presenter на события Model через emitter;

## View (Базовый абстрактный класс).
Базовый класс для управления DOM-отображением, предоставляющий универсальные методы работы с элементами страницы.

1. Конструктор: 
    - element: корневой DOM-элемент, к которому привязывается представление;
    - setting: конфигурация отображения;

2. Свойства:
    - element: HTMLElement : корневой элемент представления;
    - settings: S : настройки отображения (readonly);
    - cache: Record<string, HTMLElement> : кэш найденных DOM-элементов
    - constructor : ссылка на конструктор класса;

3. Методы: 
    1. Цикл :
        - init(): void : переопределяемый метод инициализации;
    2. Клонирование :
        - copy(settings?: S): this : Создает копию View с: 
               - новым DOM-элементом (через cloneNode);
               - Объединенными настройками (старые + новые);
    3. Работа с DOM : 
        - render(data: Partial<T>): HTMLElement: обновляет отображение на основе переданных данных;
        - ensure<T>(query?, root?): T : находит элемент через querySelector с кэшированием результата;
        - setElement(query, newElement): void : заменяет элемент по селектору на новый;
        - ensureTemplate(query): HTMLElement : клонирует шаблон и возвращает его содержимое;   
    4. Утилиты :
        - create(...): HTMLElement : фабрика DOM-элементов с настройкой атрибутов/дочерних элементов;
        - setVisibility(query, isVisible): void: показывает/скрывает элемент через display: none;
        - setValue(query, value): void: универсальный метод для обновления:
            - Текста (textContent);
            - Атрибутов (value, disabled и др.);
            - Дочерних элементов

## AppState.
Главная модель приложения, управляющая состоянием данных: товарами, корзиной, заказами и модальными окнами. Наследуется от базового Model и реализует интерфейс AppState.

1. Конструктор :
       * constructor(
         *   protected api: IStoreAPI,  // API для работы с сервером
         *  emitter: EventEmitter      // Для уведомлений View об изменениях
       * ) 

2. Свойства : 
        - products: Map<string, Product> : все товары магазина (ID → Product);
        - selectedProduct: Product | null : товар, выбранный для просмотра в модальном окне;
        - basket: Map<string, Product> : товары в корзине (ID → Product);
        - basketTotal: number : общая стоимость корзины;
        - basketCount: number : количество товаров в корзине;
        - contacts: Contacts : контактные данные пользователя (форма заказа);
        - delivery: Delivery : данные доставки и оплаты;
        - order: Order : информация о созданном заказе;
        - modal: ModalState : состояние модальных окон;

3. Методы :
    * Работа с товарами:
        - loadProducts(): Promise<void> : загружает список товаров с сервера и сохраняет в products;
        - selectProduct(id: string): void : выбирает товар по ID для отображения в превью (модальном окне);

    * Управление корзиной:
        - addToBasket(id: string): void : добавляет товар в корзину, обновляет basket, basketTotal;
        - removeFromBasket(id: string): void: удаляет товар из корзины, пересчитывает итоги;
        - toggleBasketItem(id: string): void: переключает состояние товара (добавить/удалить из корзины);

    * Оформление заказа:
        - createOrder(): Promise<OrderResult>: отправляет данные заказа (contacts, delivery, basket) на сервер;
        - fillContacts(data: Partial<Contacts>): void: обновляет контактные данные (например, email, phone);
        - fillDelivery(data: Partial<Delivery>): void: заполняет способ доставки и оплаты;
        - isValidContacts(): boolean : проверяет корректность контактов (например, валидность email);
        - isValidDelivery(): boolean: проверяет заполнены ли данные доставки;

    * Управление модальными окнами:
        - openModal(type: AppStateModals): void : открывает модальное окно (например, preview, basket, order).Генерирует событие через emitter для Presenter;
        - setMessage(message: string \| null, isError: boolean): void: устанавливает сообщение в модальном окне (успех/ошибка);

## MainView.
Главный класс представления, управляющий всеми UI-компонентами приложения. Наследуется от базового View и координирует работу каталога товаров, модального кона и глобальных элементов страницы.

1. Конструктор :
      * constructor(
       *  element: HTMLElement,      // Корневой DOM-элемент приложения
       *  settings: MainSettings     // Настройки отображения (селекторы, шаблоны)
      * )

2. Свойства : 
        - gallery: ListView<CardCatalogData> : список карточек товаров в каталоге;
        - page: PageView : глобальные элементы страницы (шапка, подвал);
        - basket: ModalView<BasketData> : модальное окно корзины;
        - preview: ModalView<CardPreviewData> : модальное окно предпросмотра товара;
        - order: ModalView<DeliveryFormData>: окно оформления заказа (доставка/оплата);
        - contacts: ModalView<ContactsFormData> : окно ввода контактных данных;
        - success: ModalView<SuccessData> : окно успешного оформления заказа;

3. Методы :
    * Инициализация:
        - init(): void : 
          * шаблоны всех компонентов;
          * коллбэки для взаимодействия;
          * связывает page.element с корневым элементом приложения;

    * Управление данными:
        - set items(value: CardCatalogData[]): void : обновляет список товаров в каталоге (gallery).
        - set selected(value: CardCatalogData): void : выделяет конкретную карточку товара (например, при предпросмотре);

    * Работа с корзиной:
        - set counter(value: number): void : обновляет счетчик товаров в корзине;

    * Управление модальными окнами:
        - set isLocked(value: boolean): void : блокирует/разблокирует прокрутку страницы при открытии модальных окон.;




















## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
