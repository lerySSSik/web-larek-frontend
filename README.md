# Проектная работа "Веб-ларек"
Интернет-магазин "Web-larek" для веб-разработчиков, где можно найти всё необходимое для успешной работы. Удобный каталог с подробными описаниями товаров, возможность добавления товаров в корзину и оформления заказов в пару кликов. Кроме того, вы можете детально ознакомиться с описанием каждого товара в карточке, чтобы выбрать именно то, что вам нужно.

## Оглавление
1. Обзор архитектуры
2. Технологический стек
3. Структура проекта
4. Важные файлы
5. Описание базовых классов
6. Слой модели данных Model
7. Слой представления View
8. Слой коммуникации
9. Установка и запуск
10. Сборка

## Обзор архитектуры
Проект реализован с использованием архитектурного паттерна MVP (Model-View-Presenter), который обеспечивает четкое разделение ответственности между ключевыми компонентами системы:

1. Модели (Model) — управление данными и бизнес-логикой:
   - ProductModel — отвечает за управление каталогом товаров;
   - BasketModel — отвечает за управление корзиной покупок;

2. Представления (View) — визуализация пользовательского интерфейса:
   - MainPageView — главная страница приложения с галереей товаров, где пользователи могут просматривать и выбирать интересующие их продукты;
   - ProductCard — универсальный компонент для отображения карточек товаров;
   - BasketView — отображает содержимое корзины покупок, включая список товаров, их количество и общую стоимость, а также предоставляет возможность оформления заказа;

3. Презентер (EventEmitter) — координация взаимодействия между слоями:
   - EventEmitter — связующее звено между моделью и представлением, которое обрабатывает события и передает данные между ними;

## Технологический стек
- HTML: Разметка веб-страниц с помощью тегов.
- SCSS: Препроцессор CSS с переменными, миксинами и функциями.
- TypeScript: Надстройка над JavaScript с статической типизацией.
- Webpack: Модуль-сборщик для объединения файлов, управления зависимостями и оптимизации кода.

## Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

## Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Описание базовых классов

### Класс Api.
Базовый HTTP-клиент для взаимодействия с серверным API. Инкапсулирует логику выполнения запросов, обработки ответов и ошибок.

1. Конструктор : 
    constructor(
        baseUrl: string,  // базовый URL API-сервера
        options: RequestInit = {} // стандарртные настройки HTTP-запросов
    )

2. Основные методы : 

    1. handleResponse(response: Response): Promise<any> :
        - Централизованный обработчик всех ответов сервера;
        - Проверяет статус ответа;
        - Обрабатывает сетевые ошибки и проблемы с парсингом;
        - Возвращает унифицированный формат данных для всего приложения;
    
    2. get(endpoint: string, params?: Record<string, any>, options?: RequestInit): Promise<any> :
        - Выполняет GET-запрос к указанному эндпоинту;
        - Параметры :
            * endpoint - путь API;
            * params - query-параметры;
            * options - дополнительные настройки запроса;
        - Особенности :
            * Автоматически добавляет базовый URL;
            * Поддерживает кастомные заголовки;
            * Обрабатывает все типы ошибок;

    3. post(endpoint: string, body: any, options?: RequestInit): Promise<any> :
        - Выполняет POST-запрос с передачей данных;
        - Пареметры :
            * endpoint - путь API;
            * body - данные для отправки;
            * options - дополнительные настройки;

### Класс Model<T>.
Базовый абстрактный класс для всех моделей данных в приложении. Реализует общую логику работы с данными и событиями. Использует дженерик для строгой типизации структуры данных модели.

1. Конструктор :
    constructor(
        data: Partial<T>,  // начальные данные модели
        protected events: IEvents // экземпляр системы событий 
    )

2. Основные методы :
    1. emitChanges(event: string, payload?: any): void :
        - Уведомляет об изменении в модели; 

### Класс EventEmitter.
Реализация паттерна "Наблюдатель" (Observer) для управления событиями в приложении. Централизованный механизм для публикации событий и подписки на них, обеспечивающий слабую связность между компонентами системы.

1. Конструктор : 
    constructor() // не требует параметров для создания экземпляра

2. Основные методы :
    - on(event: string, callback: (data?: any) => void): void :
        * Регистрирует обработчик для указанного события;
        - Параметры :
            * event - имя события;
            * callback - функция-обработчик, получающая данные события;
    - off(event: string, callback: (data?: any) => void): void : 
        * удаляет конктретный обработчик для указанногот времени;
        * возвращает ошибку если обрабочик не был зарегестрирован; 
    - emit(event: string, data?: any): void :
        * Инициирует указанное событие;
        - Параметры :
            * event - имя события;
            * data - дополнительные данные для передачи обработчикам
    - onAll(callback: (event: string, data?: any) => void): void :
        * Регистрирует глобальный обработчик для всех событий;
        * Получает имя события и данные в параметрах;
        * Полезен для логирования или  отладки; 
    - offAll(): void : 
        * Сбрасывает глобальные обработчики;
    - trigger(event: string): () => void : 
        * При вызове этой функции инициируется указанное событие;

### Класс Component<T>.
Предоставляет общие методы для работы с DOM и управления состоянием элементов интерфейса. Использует дженерик для типизации данных компонента. 

1. Конструктор :
    constructor(protected readonly container: HTMLElement // корневой DOM-элемент, контейнер для компонента
    )

2. Основные методы :
    - toggleClass(element: HTMLElement, className: string, force?: boolean): void :
        * element - целевой DOM-элемент;
        * className - имя класса для переключения;
        * force - необязательный флаг для добавления/удаления класса; 
    - setText(element: HTMLElement | null, value: string): void :
        * Устанавливает текстовое содержимое элемента ;
        * Безопасно обрабатывает случаи, когда элемент не найден;
        * Автоматически экранирует специальные символы;
    - setDisabled(element: HTMLElement, state: boolean): void:
        * Управляет состоянием disable элемента;
        * Работает с формами, кнопками и др интерективными элементами;
    - setHidden(element: HTMLElement): void и setVisible(element: HTMLElement): void :
        * Управляет видимостью через display: none;
        * Сохраняют оригинальное значение display при показе элемента;
    - setImage(element: HTMLImageElement, src: string, alt?: string): void :
        * Устанавливает изображение с обработкой ошибок загрузки;
    - render(data?: Partial<T>): HTMLElement : 
        * Отвечает за обновление DOM при изменении данных; 
        * Возвращает корневой элемент компонента;

## Слой модели данных Model.
### Класс AppState.
Централизованный хранитель состояния приложения, наследуемый от Model<IAppState>. Управляет всеми критически важными данными приложения: каталогом товаров, корзиной, оформлением заказа и ошибками валидации. Реализует бизнес-логику на уровне данных.

1. Конструктор : не переопределен.

2. Структура данных :
    {
    catalog: IProduct[];         // Полный список товаров магазина
    basket: IProduct[];          // Товары в корзине (с дубликатами)
    order: IOrder;               // Данные оформляемого заказа
    preview: string | null;      // ID товара в режиме предпросмотра
    formErrors: FormErrors;      // Ошибки валидации форм (ключ-значение)
    }

3. Методы :
    1. Управление каталогом :
        - setCatalog(items: IProduct[]) - полное обновление каталога;
        - setPreview(item: IProduct) - установка товара для предпросмотра;
    2. Работа с корзиной : 
        - addToBasket(item: IProduct) - добавление товара с проверкой наличия;
        - deleteFromBasket(item: IProduct) - удаление одного экземпляра товара;
        - deleteAllFromBasket() - полная очистка корзины;
        - getBasketAmount() → number - подсчет общего количества позиций;
        - getBasketTotal() → number - расчет итоговой суммы с акциями;
    3. Оформление заказа :
        - setOrderField(field, value) - установка полей доставки/оплаты;
        - setContactsField(field, value) - установка контактных данных;
        - resetOrder() - сброс всех данных заказа;
    4. Валидация :
        - validateOrder() → boolean - проверка обязательных полей доставки;
        - validateContacts() → boolean - валидация; 

## Слой представления View. 
### Класс Page.
Базовый контейнер приложения, наследуемый от Component<IPage>. Управляет основными структурными элементами страницы: отображением каталога товаров, индикатором корзины и состоянием блокировки интерфейса. Служит точкой интеграции для основных модулей приложения.

1. Конструктор :
    constructor(
        container: HTMLElement,  // корневой DOM-элемент страницы
        protected events: IEvents // система событий для межкомпонентного взаимодействия
    )

2. Интерфейс управления состоянием :
    - set counter(value: number) :
        * Обновляет счетчик товаров в корзине;
        * Автоматически скрывает индификатор при нулевом значении;
        * Поддерживает анимацию изменения значения;
    - set catalog(items: HTMLElement[]) :
        * Рендерит массив карточек товаров в каталоге;
        * Поддерживает ленивуюзагрузку изображений, постепенное появление элементов, обработку пустого состояния каталога;
    - set locked(value: boolean) :
        * Устанавливает состояние блокировки страницы;

### Класс Modal. 
Универсальный компонент для работы с модальными окнами, наследуемый от Component<IModalData>. Обеспечивает отображение различного контента во всплывающем окне с базовой функциональностью открытия/закрытия. 

1. Конструктор :
    constructor(
        container: HTMLElement, // корневой элемент модального окна
        protected events: IEvents // система событий для взаимодействия с др компонентами
    )

2. Основные методы :
    - set content(value: HTMLElement) :
        * Заменяет текущий конктент модального окна;
        * Очищает предыдущее содержимое;
    - open() :
        * Актививрует модальное окно
    - close() :
        * Деактивирует модальное окно;
        * Автоматически сбрасывает контент;   
    - render(data: IModalData) :
        * Комплексное обновление модального окна;

### Класс Basket. 
Компонент управления корзиной товаров(отображение списка добавленных товаров, расчет и отображение общей стоимости, контроль состояния кнопки оформления заказа, взаимодействие с другими компонентами через систему событий)

1. Конструктор :
    constructor(
        container: HTMLElement, 
        protected events: IEvents
    )

2. Основные методы :
    - updateButtonState(isActive: boolean): void :
        * Контролирует доступность кнопки оформления заказа;
        * Автоматически вызывается при изменении суммы заказа;

3. Сеттеры :
    - set price(total: number): void :
        * Обновляет отображение общей суммы;
        * Автоматически  вызывает updateButtonState;
    - set items(items: HTMLElement[]): void :
        * Обновляет список товаров в интерфейсе;
        * Синхронизируется с системой событий;

### Класс Form.
Базовый компонент для работы с HTML-формами, наследуемый от Component.

1. Конструктор :
    constructor(
        protected container: HTMLFormElement, //элемент <form>, представляющий саму форму
        protected events: IEvents //система событий для обработки действий
    )

2. Основные методы :
    - onInputChange(field: keyof T, value: string): void :
        * Обработчик изменений полей ввода;
    - render(state: Partial<T> & IFormValidator): void :
        * Комплексное обновление формы;
    - set valid(isValid: boolean): void :
        * Управление доступностью формы
    - set errors(messages: string): void :
        * Отображение ошибок валидации;   

### Класс Success.
Компонент для отображения экрана успешного завершения заказа.

1. Структура :
    {
        _close: HTMLElement;      // Кнопка закрытия/подтверждения
        _totalPrice: HTMLElement; // Блок с отображением итоговой суммы
        events: IEvents;          // Система обработки событий
    }

2. Основные методы :
    - set total(value: string | number) :
        * Устанавливает итоговую сумму заказа;
    - set onClose(callback: () => void) :
        * Настраивает обработчик закрытия;

### Слой коммуникации.
### Класс AppApi.
Специализированный API-клиент для работы с backend-сервисом, расширяющий базовый функционал класса Api. Обеспечивает взаимодействие с API, включая работу с товарами и оформление заказов.

1. Конструктор : 
    constructor(
        baseUrl: string, 
        cdn: string, options?: RequestInit
    )

2. Основные методы :
    - getProducts(): Promise<IProduct[]> : 
        * Получает полный каталог товаров с сервера;
        * Возвращает массив объектов товаров с преобразованными URL-изображений;
        * Обрабатывает случаи пустого каталога, ошибок загрузки, неверного формата данных;
    - getProductById(id: string): Promise<IProduct> :
        * Запрашивает детальную информацию о конкретном товаре ;
        * id - уникальный идентификатор товара;
    - postOrder(order: ICustomer): Promise<TSuccessData> :
        * Отправляет данные на сервер;
        * Обрабатывает различные статусы ответа;
    
## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
